{% extends "base.html" %}
{% load staticfiles %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <div class="">
      <div class="card">
        <div class="card-header" data-background-color="rose">
          <h4 class="card-title">Agregar imagen</h4>
          <p class="category">Imagen para aprendizaje</p>
        </div>
        <div class="card-content text-center">
          <form method="post" class="form-horizontal" action="" ENCTYPE="multipart/form-data">{% csrf_token %}
            <div class="row col-sm-offset-2">
              <div class="col-sm-4">
                <legend>Seleccione una mamografía</legend>
                <div class="fileinput fileinput-new text-center" data-provides="fileinput">
                  <div class="fileinput-new thumbnail">
                    <img src="{% static 'img/image_placeholder.jpg' %}" alt="...">
                  </div>
                  <div class="fileinput-preview fileinput-exists thumbnail"></div>
                  <div>
                    <span class="btn btn-rose btn-round btn-file">
                      <span class="fileinput-new">Seleccionar imagen</span>
                      <span class="fileinput-exists">Cambiar</span>
                      {{ form.imgad_ruta }}
                      <span class="text-danger">{{ form.errors.imgad_ruta.as_text }}</span>
                    </span>
                    <a href="#" class="btn btn-danger btn-round fileinput-exists" data-dismiss="fileinput"><i class="fa fa-times"></i> Quitar</a>
                  </div>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="row">
                  <div class="form-group label-floating">
                    {{ form.tc_id.label_tag }}
                    {{ form.tc_id }}
                    <span class="text-danger">{{ form.errors.tc_id.as_text }}</span>
                  </div>
                </div>
                <br>
                <div class="row">
                  <div class="form-group label-floating">
                    <label class="control-label">Descripcion de la imagen:</label>
                    {{ form.imgad_descripcion }}
                    <span class="text-danger">{{ form.errors.imgad_descripcion.as_text }}</span>
                  </div>
                </div>
              </div>
              <div class="row oculto">
                <div class="col-md-6">
                  <div class="form-group label-floating">
                    {{ form.imgad_ancho }}
                  </div>
                </div>
              </div>
              <div class="row oculto">
                <div class="col-md-6">
                  <div class="form-group label-floating">
                    {{ form.imgad_alto }}
                  </div>
                </div>
              </div>
            </div>
            <a href="{% url 'imagen' %}" class="btn btn-danger pull-center">Cancelar</a>
            <button type="submit" class="btn btn-success pull-center">Guardar</button>
            <div class="clearfix"></div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<img src=""  id="mifoto" class="oculto">
{% endblock content %}
{% block jscrpt %}
<script type="text/javascript">
$( document ).ready(function() {
  $(".oculto").hide();
});
//-----------------------------funcion apara vista previa-------------------------------------------
function archivo(evt) {
  var files = evt.target.files; // FileList object

  // Obtenemos la imagen del campo "file".
  for (var i = 0, f; f = files[i]; i++) {
    //Solo admitimos imágenes.
    if (!f.type.match('image.*')) {
      continue;
    }

    var reader = new FileReader();

    reader.onload = (function(theFile) {
      return function(e) {
        // Insertamos la imagen
        // document.getElementById("list").innerHTML = ['<img class="thumb" src="', e.target.result,'" title="', escape(theFile.name), '"/>'].join('');
        // alert('ruta:'+e.target.result+'');
        $("#mifoto").attr('src', ''+e.target.result+'');
        $("#mifoto").removeAttr('width');
        $("#mifoto").removeAttr('height');
        var imagen = $('#mifoto');
        $("#id_imgad_ancho").val(''+imagen.width());
        $("#id_imgad_alto").val(''+imagen.height());
        // $('#ver_ruta').val('ruta:'+e.target.result+'');
        // $('#canvas').css('background', 'url('+e.target.result+') ');
        // $('#canvas').css('background-size', '100% 100%');
        // $('#canvas').css('background', 'url('+e.target.result+')');
      };
    })(f);

    reader.readAsDataURL(f);
  }
}

document.getElementById('id_imgad_ruta').addEventListener('change', archivo, false);
//-------------------------------------------------------------------------------------------------
$("#id_imgad_ruta").change(function(e) {
  var x = document.getElementById("id_imgad_ruta");
  if ('files' in x) {
    if (x.files.length == 0) {
    } else {
      for (var i = 0; i < x.files.length; i++) {
        var file = x.files[i];
        if ('name' in file) {
          $("#ver_ruta").val(""+file.name);
        }
      }
      $("#ver_ruta").val(""+file.name);
    }
  }
});
</script>
{% endblock jscrpt %}
